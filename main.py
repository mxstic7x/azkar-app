import flet as ft
import time

def main(page: ft.Page):
    # =====================================================================
    #                           إعدادات الصفحة والتصميم
    # =====================================================================
    
    # تحميل خط "كايرو" من جوجل مباشرة لضمان الشكل العربي الجميل
    page.fonts = {
        "Cairo": "https://github.com/google/fonts/raw/main/ofl/cairo/Cairo-Bold.ttf",
        "CairoReg": "https://github.com/google/fonts/raw/main/ofl/cairo/Cairo-Regular.ttf"
    }
    
    page.title = "ذكرني"
    page.theme = ft.Theme(font_family="Cairo") 
    page.theme_mode = ft.ThemeMode.LIGHT
    page.rtl = True
    page.scroll = "hidden"
    page.bgcolor = "#F0F4F8" # خلفية رمادية مائلة للأزرق مريحة للعين
    page.window_width = 390
    page.window_height = 840

    try:
        # =====================================================================
        #                           قاعدة بيانات الأذكار (كاملة)
        # =====================================================================
        AZKAR_DATA = {
            "morning": [
                {"text": "أَعُوذُ بِاللهِ مِنْ الشَّيْطَانِ الرَّجِيمِ. اللّهُ لاَ إِلَـهَ إِلاَّ هُوَ الْحَيُّ الْقَيُّومُ لاَ تَأْخُذُهُ سِنَةٌ وَلاَ نَوْمٌ لَّهُ مَا فِي السَّمَاوَاتِ وَمَا فِي الأَرْضِ مَن ذَا الَّذِي يَشْفَعُ عِنْدَهُ إِلاَّ بِإِذْنِهِ يَعْلَمُ مَا بَيْنَ أَيْدِيهِمْ وَمَا خَلْفَهُمْ وَلاَ يُحِيطُونَ بِشَيْءٍ مِّنْ عِلْمِهِ إِلاَّ بِمَا شَاء وَسِعَ كُرْسِيُّهُ السَّمَاوَاتِ وَالأَرْضَ وَلاَ يَؤُودُهُ حِفْظُهُمَا وَهُوَ الْعَلِيُّ الْعَظِيمُ. [آية الكرسي]", "count": 1, "desc": "من قالها حين يصبح أجير من الجن حتى يمسى"},
                {"text": "بِسْمِ اللهِ الرَّحْمنِ الرَّحِيم. قُلْ هُوَ ٱللَّهُ أَحَدٌ، ٱللَّهُ ٱلصَّمَدُ، لَمْ يَلِدْ وَلَمْ يُولَدْ، وَلَمْ يَكُن لَّهُۥ كُفُوًا أَحَدٌۢ. (3 مرات)", "count": 3, "desc": "تكفيه من كل شيء"},
                {"text": "بِسْمِ اللهِ الرَّحْمنِ الرَّحِيم. قُلْ أَعُوذُ بِرَبِّ ٱلْفَلَقِ، مِن شَرِّ مَا خَلَقَ، وَمِن شَرِّ غَاسِقٍ إِذَا وَقَبَ، وَمِن شَرِّ ٱلنَّفَّٰثَٰتِ فِى ٱلْعُقَدِ، وَمِن شَرِّ حَاسِدٍ إِذَا حَسَدَ. (3 مرات)", "count": 3, "desc": "تكفيه من كل شيء"},
                {"text": "بِسْمِ اللهِ الرَّحْمنِ الرَّحِيم. قُلْ أَعُوذُ بِرَبِّ ٱلنَّاسِ، مَلِكِ ٱلنَّاسِ، إِلَٰهِ ٱلنَّاسِ، مِن شَرِّ ٱلْوَسْوَاسِ ٱلْخَنَّاسِ، ٱلَّذِى يُوَسْوِسُ فِى صُدُورِ ٱلنَّاسِ، مِنَ ٱلْجِنَّةِ وَٱلنَّاسِ. (3 مرات)", "count": 3, "desc": "تكفيه من كل شيء"},
                {"text": "أَصْـبَحْنا وَأَصْـبَحَ المُـلْكُ لله وَالحَمدُ لله، لا إلهَ إلاّ اللّهُ وَحدَهُ لا شَريكَ لهُ، لهُ المُـلكُ ولهُ الحَمْـد، وهُوَ على كلّ شَيءٍ قدير، رَبِّ أسْـأَلُـكَ خَـيرَ ما في هـذا اليوم وَخَـيرَ ما بَعْـدَه، وَأَعـوذُ بِكَ مِنْ شَـرِّ ما في هـذا اليوم وَشَرِّ ما بَعْـدَه، رَبِّ أَعـوذُ بِكَ مِنَ الْكَسَـلِ وَسـوءِ الْكِـبَر، رَبِّ أَعـوذُ بِكَ مِنْ عَـذابٍ في النّـارِ وَعَـذابٍ في القَـبْر.", "count": 1, "desc": ""},
                {"text": "اللّهـمَّ أَنْتَ رَبِّـي لا إلهَ إلاّ أَنْتَ، خَلَقْتَنـي وَأَنا عَبْـدُك، وَأَنا عَلـى عَهْـدِكَ وَوَعْـدِكَ ما اسْتَـطَعْـت، أَعـوذُ بِكَ مِنْ شَـرِّ ما صَنَـعْت، أَبـوءُ لَـكَ بِنِعْـمَتِـكَ عَلَـيَّ وَأَبـوءُ بِذَنْـبي فَاغْفـِرْ لي فَإِنَّـهُ لا يَغْـفِرُ الذُّنـوبَ إِلاّ أَنْتَ. (سيد الاستغفار)", "count": 1, "desc": "من قالها موقنا بها حين يمسى ومات في ليلته دخل الجنة، وكذلك الصباح."},
                {"text": "رَضيـتُ بِاللهِ رَبَّـاً وَبِالإسْلامِ ديـناً وَبِمُحَـمَّدٍ صلى الله عليه وسلم نَبِيّـاً.", "count": 3, "desc": "كان حقا على الله أن يرضيه يوم القيامة"},
                {"text": "اللّهُـمَّ إِنِّـي أَصْبَـحْتُ أُشْـهِدُك، وَأُشْـهِدُ حَمَلَـةَ عَـرْشِـك، وَمَلَائِكَتَكَ، وَجَمـيعَ خَلْـقِك، أَنَّـكَ أَنْـتَ اللهُ لا إلهَ إلاّ أَنْـتَ وَحْـدَكَ لا شَريكَ لَـك، وَأَنَّ ُ مُحَمّـداً عَبْـدُكَ وَرَسـولُـك.", "count": 4, "desc": "من قالها أعتقه الله من النار"},
                {"text": "اللّهُـمَّ ما أَصْبَـَحَ بي مِـنْ نِعْـمَةٍ أَو بِأَحَـدٍ مِـنْ خَلْـقِك ، فَمِـنْكَ وَحْـدَكَ لا شريكَ لَـك ، فَلَـكَ الْحَمْـدُ وَلَـكَ الشُّكْـر.", "count": 1, "desc": "من قالها صباحا أدى شكر يومه"},
                {"text": "حَسْبِـيَ اللّهُ لا إلهَ إلاّ هُوَ عَلَـيهِ تَوَكَّـلتُ وَهُوَ رَبُّ العَرْشِ العَظـيم.", "count": 7, "desc": "كفاه الله ما أهمه من أمر الدنيا والأخرة"},
                {"text": "بِسـمِ اللهِ الذي لا يَضُـرُّ مَعَ اسمِـهِ شَيءٌ في الأرْضِ وَلا في السّمـاءِ وَهـوَ السّمـيعُ العَلـيم.", "count": 3, "desc": "لم يضره من الله شيء"},
                {"text": "اللّهُـمَّ بِكَ أَصْـبَحْنا وَبِكَ أَمْسَـينا، وَبِكَ نَحْـيا وَبِكَ نَمُـوتُ وَإِلَـيْكَ النُّـشُور.", "count": 1, "desc": ""},
                {"text": "أَصْبَـحْـنا عَلَى فِطْرَةِ الإسْلاَمِ، وَعَلَى كَلِمَةِ الإِخْلاَصِ، وَعَلَى دِينِ نَبِيِّنَا مُحَمَّدٍ صَلَّى اللهُ عَلَيْهِ وَسَلَّمَ، وَعَلَى مِلَّةِ أَبِينَا إبْرَاهِيمَ حَنِيفاً مُسْلِماً وَمَا كَانَ مِنَ المُشْرِكِينَ.", "count": 1, "desc": ""},
                {"text": "سُبْحـانَ اللهِ وَبِحَمْـدِهِ عَدَدَ خَلْـقِه، وَرِضـا نَفْسِـه، وَزِنَـةَ عَـرْشِـه، وَمِـدادَ كَلِمـاتِـه.", "count": 3, "desc": ""},
                {"text": "اللّهُـمَّ عافِـني في بَدَنـي، اللّهُـمَّ عافِـني في سَمْـعي، اللّهُـمَّ عافِـني في بَصَـري، لا إلهَ إلاّ أَنْـتَ.", "count": 3, "desc": ""},
                {"text": "اللّهُـمَّ إِنّـي أَعـوذُ بِكَ مِنَ الْكُـفر، وَالفَـقْر، وَأَعـوذُ بِكَ مِنْ عَذابِ القَـبْر، لا إلهَ إلاّ أَنْـتَ.", "count": 3, "desc": ""},
                {"text": "اللّهُـمَّ إِنِّـي أسْـأَلُـكَ العَـفْوَ وَالعـافِـيةَ في الدُّنْـيا وَالآخِـرَة، اللّهُـمَّ إِنِّـي أسْـأَلُـكَ العَـفْوَ وَالعـافِـيةَ في ديني وَدُنْـيايَ وَأهْـلي وَمالـي، اللّهُـمَّ اسْتُـرْ عـوْراتي وَآمِـنْ رَوْعاتي، اللّهُـمَّ احْفَظْـني مِن بَـينِ يَدَيَّ وَمِن خَلْفـي وَعَن يَمـيني وَعَن شِمـالي، وَمِن فَوْقـي، وَأَعـوذُ بِعَظَمَـتِكَ أَن أُغْـتالَ مِن تَحْتـي.", "count": 1, "desc": ""},
                {"text": "يَا حَيُّ يَا قيُّومُ بِرَحْمَتِكَ أسْتَغِيثُ أصْلِحْ لِي شَأنِي كُلَّهُ وَلاَ تَكِلْنِي إلَى نَفْسِي طَـرْفَةَ عَيْنٍ.", "count": 3, "desc": ""},
                {"text": "أَصْبَـحْـنا وَأَصْبَـحْ المُـلكُ للهِ رَبِّ العـالَمـين، اللّهُـمَّ إِنِّـي أسْـأَلُـكَ خَـيْرَ هـذا الـيَوْم ، فَـتْحَهُ، وَنَصْـرَهُ، وَنـورَهُ وَبَـرَكَتَـهُ، وَهُـداهُ، وَأَعـوذُ بِـكَ مِـنْ شَـرِّ ما فـيهِ وَشَـرِّ ما بَعْـدَه.", "count": 1, "desc": ""},
                {"text": "اللّهُـمَّ عالِـمَ الغَـيْبِ وَالشّـهادَةِ فاطِـرَ السّماواتِ وَالأرْضِ رَبَّ كـلِّ شَـيءٍ وَمَليـكَه، أَشْهَـدُ أَنْ لا إِلـهَ إِلاّ أَنْت، أَعـوذُ بِكَ مِن شَـرِّ نَفْسـي وَمِن شَـرِّ الشَّيْـطانِ وَشِرْكِهِ، وَأَنْ أَقْتَـرِفَ عَلـى نَفْسـي سوءاً أَوْ أَجُـرَّهُ إِلـى مُسْـلِم.", "count": 1, "desc": ""},
                {"text": "أَعـوذُ بِكَلِمـاتِ اللّهِ التّـامّـاتِ مِنْ شَـرِّ ما خَلَـق.", "count": 3, "desc": ""},
                {"text": "اللَّهُمَّ صَلِّ وَسَلِّمْ وَبَارِكْ على سيدنا مُحمَّد.", "count": 10, "desc": "أدركته شفاعتي يوم القيامة"},
                {"text": "اللَّهُمَّ إِنَّا نَعُوذُ بِكَ مِنْ أَنْ نُشْرِكَ بِكَ شَيْئًا نَعْلَمُهُ، وَنَسْتَغْفِرُكَ لِمَا لَا نَعْلَمُهُ.", "count": 3, "desc": ""},
                {"text": "اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنْ الْهَمِّ وَالْحَزَنِ، وَأَعُوذُ بِكَ مِنْ الْعَجْزِ وَالْكَسَلِ، وَأَعُوذُ بِكَ مِنْ الْجُبْنِ وَالْبُخْلِ، وَأَعُوذُ بِكَ مِنْ غَلَبَةِ الدَّيْنِ، وَقَهْرِ الرِّجَالِ.", "count": 3, "desc": ""},
                {"text": "أسْتَغْفِرُ اللهَ العَظِيمَ الَّذِي لاَ إلَهَ إلاَّ هُوَ، الحَيُّ القَيُّومُ، وَأتُوبُ إلَيهِ.", "count": 3, "desc": ""},
                {"text": "يَا رَبِّ، لَكَ الْحَمْدُ كَمَا يَنْبَغِي لِجَلَالِ وَجْهِكَ، وَلِعَظِيمِ سُلْطَانِكَ.", "count": 3, "desc": ""},
                {"text": "اللَّهُمَّ إِنِّي أَسْأَلُكَ عِلْمًا نَافِعًا، وَرِزْقًا طَيِّبًا، وَعَمَلًا مُتَقَبَّلًا.", "count": 1, "desc": ""},
                {"text": "اللَّهُمَّ أَنْتَ رَبِّي لا إِلَهَ إِلا أَنْتَ، عَلَيْكَ تَوَكَّلْتُ ، وَأَنْتَ رَبُّ الْعَرْشِ الْعَظِيمِ، مَا شَاءَ اللَّهُ كَانَ، وَمَا لَمْ يَشَأْ لَمْ يَكُنْ، وَلا حَوْلَ وَلا قُوَّةَ إِلا بِاللَّهِ الْعَلِيِّ الْعَظِيمِ، أَعْلَمُ أَنَّ اللَّهَ عَلَى كُلِّ شَيْءٍ قَدِيرٌ، وَأَنَّ اللَّهَ قَدْ أَحَاطَ بِكُلِّ شَيْءٍ عِلْمًا، اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنْ شَرِّ نَفْسِي، وَمِنْ شَرِّ كُلِّ دَابَّةٍ أَنْتَ آخِذٌ بِنَاصِيَتِهَا ، إِنَّ رَبِّي عَلَى صِرَاطٍ مُسْتَقِيمٍ.", "count": 1, "desc": ""},
                {"text": "لَا إلَه إلّا اللهُ وَحْدَهُ لَا شَرِيكَ لَهُ، لَهُ الْمُلْكُ وَلَهُ الْحَمْدُ وَهُوَ عَلَى كُلِّ شَيْءِ قَدِيرِ.", "count": 100, "desc": "كانت له عدل عشر رقاب، وكتبت له مئة حسنة، ومحيت عنه مئة سيئة، وكانت له حرزا من الشيطان"},
                {"text": "سُبْحـانَ اللهِ وَبِحَمْـدِهِ.", "count": 100, "desc": "حُطَّتْ خَطَايَاهُ وَإِنْ كَانَتْ مِثْلَ زَبَدِ الْبَحْرِ"},
                {"text": "أسْتَغْفِرُ اللهَ وَأتُوبُ إلَيْهِ.", "count": 100, "desc": ""}
            ],
            "evening": [
                {"text": "أَعُوذُ بِاللهِ مِنْ الشَّيْطَانِ الرَّجِيمِ. اللّهُ لاَ إِلَـهَ إِلاَّ هُوَ الْحَيُّ الْقَيُّومُ لاَ تَأْخُذُهُ سِنَةٌ وَلاَ نَوْمٌ... [آية الكرسي]", "count": 1, "desc": "أجير من الجن"},
                {"text": "آمَنَ الرَّسُولُ بِمَا أُنْزِلَ إِلَيْهِ مِنْ رَبِّهِ... [خواتيم البقرة]", "count": 1, "desc": "من قرأهما في ليلة كفتاه"},
                {"text": "قُلْ هُوَ ٱللَّهُ أَحَدٌ (3) - الفلق (3) - الناس (3)", "count": 3, "desc": "تكفيه من كل شيء"},
                {"text": "أمسيـنا وأمسـى المـلك لله والحمد لله ، لا إله إلا الله وحده لا شريك له، له المـلك وله الحمـد، وهو على كل شيء قدير ، رب أسـألـك خـير ما في هـذه اللـيلة وخـير ما بعـدهـا ، وأعـوذ بك من شـر ما في هـذه اللـيلة وشر ما بعـدهـا ، رب أعـوذ بك من الكسـل وسـوء الكـبر ، رب أعـوذ بك من عـذاب في النـار وعـذاب في القـبر.", "count": 1, "desc": ""},
                {"text": "اللهـم أنت ربـي لا إله إلا أنت ، خلقتنـي وأنا عبـدك ، وأنا علـى عهـدك ووعـدك ما استـطعـت ، أعـوذ بك من شـر ما صنـعت ، أبـوء لـك بنعـمتـك علـي وأبـوء بذنـبي فاغفـر لي فإنـه لا يغـفر الذنـوب إلا أنت. (سيد الاستغفار)", "count": 1, "desc": "من مات في ليلته دخل الجنة"},
                {"text": "رضيـت بالله ربـا وبالإسلام ديـنا وبمحـمد صلى الله عليه وسلم نبيـا.", "count": 3, "desc": "كان حقا على الله أن يرضيه يوم القيامة"},
                {"text": "اللهـم إنـي أمسيت أشـهدك ، وأشـهد حملـة عـرشـك ، وملائكتك ، وجمـيع خلـقك ، أنـك أنـت الله لا إله إلا أنـت وحـدك لا شريك لـك ، وأن محمـدا عبـدك ورسـولـك.", "count": 4, "desc": "أعتقه الله من النار"},
                {"text": "اللهـم ما أمسى بي مـن نعـمة أو بأحـد مـن خلـقك ، فمـنك وحـدك لا شريك لـك ، فلـك الحمـد ولـك الشكـر.", "count": 1, "desc": "أدى شكر ليلته"},
                {"text": "حسبـي الله لا إله إلا هو علـيه توكـلت وهو رب العرش العظـيم.", "count": 7, "desc": "كفاه الله ما أهمه من أمر الدنيا والأخرة"},
                {"text": "بسـم الله الذي لا يضـر مع اسمـه شيء في الأرض ولا في السمـاء وهـو السمـيع العلـيم.", "count": 3, "desc": "لم يضره من الله شيء"},
                {"text": "اللهـم بك أمسـينا وبك أصـبحنا، وبك نحـيا وبك نمـوت وإلـيك المصير.", "count": 1, "desc": ""},
                {"text": "أمسينا على فطرة الإسلام، وعلى كلمة الإخلاص، وعلى دين نبينا محمد صلى الله عليه وسلم، وعلى ملة أبينا إبراهيم حنيفا مسلما وما كان من المشركين.", "count": 1, "desc": ""},
                {"text": "سبحـان الله وبحمـده عدد خلـقه ، ورضـا نفسـه ، وزنـة عـرشـه ، ومـداد كلمـاتـه.", "count": 3, "desc": ""},
                {"text": "اللهـم عافـني في بدنـي ، اللهـم عافـني في سمـعي ، اللهـم عافـني في بصـري ، لا إله إلا أنـت.", "count": 3, "desc": ""},
                {"text": "اللهـم إنـي أعـوذ بك من الكـفر ، والفـقر ، وأعـوذ بك من عذاب القـبر ، لا إله إلا أنـت.", "count": 3, "desc": ""},
                {"text": "اللهـم إنـي أسـألـك العـفو والعـافـية في الدنـيا والآخـرة ، اللهـم إنـي أسـألـك العـفو والعـافـية في ديني ودنـياي وأهـلي ومالـي ، اللهـم استـر عـوراتي وآمـن روعاتـي ، اللهـم احفظـني من بـين يدي ومن خلفـي وعن يمـيني وعن شمـالي ، ومن فوقـي ، وأعـوذ بعظمـتك أن أغـتال من تحتـي.", "count": 1, "desc": ""},
                {"text": "يا حي يا قيوم برحمتك أستغيث أصلح لي شأني كله ولا تكلني إلى نفسي طـرفة عين.", "count": 3, "desc": ""},
                {"text": "أمسينا وأمسى الملك لله رب العالمين، اللهم إني أسألك خير هذه الليلة فتحها ونصرها، ونورها وبركتها، وهداها، وأعوذ بك من شر ما فيها وشر ما بعدها.", "count": 1, "desc": ""},
                {"text": "اللهـم عالـم الغـيب والشـهادة فاطـر السماوات والأرض رب كـل شـيء ومليـكه ، أشهـد أن لا إلـه إلا أنت ، أعـوذ بك من شـر نفسـي ومن شـر الشيـطان وشركه ، وأن أقتـرف علـى نفسـي سوءا أو أجـره إلـى مسـلم.", "count": 1, "desc": ""},
                {"text": "أَعـوذُ بِكَلِمـاتِ اللّهِ التّـامّـاتِ مِنْ شَـرِّ ما خَلَـق.", "count": 3, "desc": ""},
                {"text": "اللهم صل وسلم وبارك على نبينا محمد.", "count": 10, "desc": "أدركته شفاعتي يوم القيامة"},
                {"text": "اللهم إنا نعوذ بك من أن نشرك بك شيئا نعلمه ، ونستغفرك لما لا نعلمه.", "count": 3, "desc": ""},
                {"text": "اللهم إني أعوذ بك من الهم والحزن، وأعوذ بك من العجز والكسل، وأعوذ بك من الجبن والبخل، وأعوذ بك من غلبة الدين، وقهر الرجال.", "count": 3, "desc": ""},
                {"text": "أستغفر الله العظيم الذي لا إله إلا هو، الحي القيوم، وأتوب إليه.", "count": 3, "desc": ""},
                {"text": "يا رب , لك الحمد كما ينبغي لجلال وجهك , ولعظيم سلطانك.", "count": 3, "desc": ""},
                {"text": "اللهم إني أسألك علما نافعا، ورزقا طيبا، وعملا متقبلا.", "count": 1, "desc": ""},
                {"text": "اللهم أنت ربي لا إله إلا أنت ، عليك توكلت ، وأنت رب العرش العظيم , ما شاء الله كان ، وما لم يشأ لم يكن ، ولا حول ولا قوة إلا بالله العلي العظيم , أعلم أن الله على كل شيء قدير ، وأن الله قد أحاط بكل شيء علما , اللهم إني أعوذ بك من شر نفسي ، ومن شر كل دابة أنت آخذ بناصيتها ، إن ربي على صراط مستقيم.", "count": 1, "desc": ""},
                {"text": "لا إله إلا الله وحده لا شريك له، له الملك وله الحمد وهو على كل شيء قدير.", "count": 100, "desc": "كانت له عدل عشر رقاب، وكتبت له مئة حسنة، ومحيت عنه مئة سيئة، وكانت له حرزا من الشيطان"},
                {"text": "سُبْحـانَ اللهِ وَبِحَمْـدِهِ.", "count": 100, "desc": "حُطَّتْ خَطَايَاهُ وَإِنْ كَانَتْ مِثْلَ زَبَدِ الْبَحْرِ"},
                {"text": "أسْتَغْفِرُ اللهَ وَأتُوبُ إلَيْهِ.", "count": 100, "desc": ""}
            ],
            "sleep": [
                {"text": "اللّهُـمَّ إِنَّـكَ خَلَـقْتَ نَفْسـي وَأَنْـتَ تَوَفّـاهـا لَكَ ممَـاتـها وَمَحْـياها ، إِنْ أَحْيَيْـتَها فاحْفَظْـها ، وَإِنْ أَمَتَّـها فَاغْفِـرْ لَـها . اللّهُـمَّ إِنَّـي أَسْـأَلُـكَ العـافِـيَة.", "count": 1, "desc": ""},
                {"text": "اللّهُـمَّ قِنـي عَذابَـكَ يَـوْمَ تَبْـعَثُ عِبـادَك.", "count": 3, "desc": "يقولها حين يضع يده اليمنى تحت خده الأيمن."},
                {"text": "بِاسْـمِكَ اللّهُـمَّ أَمـوتُ وَأَحْـيا.", "count": 1, "desc": ""},
                {"text": "باسمك رب وضعت جنبي وبك أرفعه، إن أمسكت نفسي فارحمها، وإن أرسلتها فاحفظها بما تحفظ به عبادك الصالحين.", "count": 1, "desc": ""},
                {"text": "اللهم أسلمت نفسي إليك، ووجهت وجهي إليك، وفوضت أمري إليك، وألجأت ظهري إليك، رغبة ورهبة إليك، لا ملجأ ولا منجا منك إلا إليك، آمنت بكتابك الذي أنزلت، وبنبيك الذي أرسلت.", "count": 1, "desc": "من قالها ومات في ليلته مات على الفطرة"},
                {"text": "الـحَمْدُ للهِ الَّذي أَطْـعَمَنا وَسَقـانا، وَكَفـانا، وَآوانا، فَكَـمْ مِمَّـنْ لا كـافِيَ لَـهُ وَلا مُـؤْوي.", "count": 1, "desc": ""},
                {"text": "سُبْحَانَ اللَّه (33) , الْحَمْدُ لِلَّهِ (33) , اللَّهُ أَكْبَرُ (34)", "count": 1, "desc": "خير له من خادم"},
                {"text": "الإخلاص والمعوذتين (مع النفث والمسح على الجسد)", "count": 3, "desc": ""}
            ]
        }

        # =====================================================================
        #                           عناصر الواجهة المخصصة
        # =====================================================================
        
        current_category = []
        current_index = 0
        current_count = 0

        # 1. شريط العنوان المطور
        app_bar = ft.Container(
            content=ft.Row([
                ft.Icon(ft.icons.MOSQUE_ROUNDED, color="white", size=32),
                ft.Container(width=10),
                ft.Text("ذَكِّرْنِي", size=24, weight="bold", color="white", font_family="Cairo"),
            ], alignment="center"),
            padding=ft.padding.only(top=40, bottom=20),
            gradient=ft.LinearGradient(
                begin=ft.alignment.top_right,
                end=ft.alignment.bottom_left,
                colors=["#00b09b", "#96c93d"],
            ),
            border_radius=ft.border_radius.only(bottom_left=30, bottom_right=30),
            shadow=ft.BoxShadow(blur_radius=15, color="#33000000", offset=ft.Offset(0, 5))
        )

        # 2. عناصر صفحة الأذكار
        txt_zikr = ft.Text("", size=20, weight="bold", text_align="center", color="#2d3436", font_family="Cairo")
        txt_desc = ft.Text("", size=14, color="#00b894", text_align="center", font_family="CairoReg", weight="bold")
        txt_counter = ft.Text("0", size=55, color="white", weight="bold", font_family="Cairo")
        
        # شريط التقدم
        progress_bar = ft.ProgressBar(width=280, color="#00b09b", bgcolor="#dfe6e9", value=0, height=8, border_radius=4)
        txt_progress_text = ft.Text("0/0", color="#636e72", size=13, weight="bold")

        # زر العداد (تصميم عصري)
        btn_sbh = ft.Container(
            content=txt_counter,
            width=170, height=170,
            border_radius=85,
            alignment=ft.alignment.center,
            shape=ft.BoxShape.CIRCLE,
            gradient=ft.LinearGradient(
                begin=ft.alignment.top_left,
                end=ft.alignment.bottom_right,
                colors=["#4facfe", "#00f2fe"],
            ),
            shadow=ft.BoxShadow(blur_radius=20, color="#4facfe", offset=ft.Offset(0, 8)),
            animate_scale=ft.animation.Animation(100, ft.AnimationCurve.EASE_OUT),
            on_click=lambda e: on_click_counter(e)
        )

        # =====================================================================
        #                           المنطق (Logic)
        # =====================================================================

        def update_view():
            if current_index < len(current_category):
                item = current_category[current_index]
                txt_zikr.value = item['text']
                txt_desc.value = f"✨ {item['desc']}" if item['desc'] else ""
                txt_counter.value = str(current_count)
                
                progress_val = (current_index) / len(current_category)
                progress_bar.value = progress_val
                txt_progress_text.value = f"الذكر {current_index + 1} من {len(current_category)}"
                
                btn_sbh.gradient = ft.LinearGradient(colors=["#4facfe", "#00f2fe"])
                btn_sbh.disabled = False
                btn_sbh.shadow.color = "#4facfe"
            else:
                txt_zikr.value = "✨ صدق الله العظيم ✨\nتقبل الله طاعتكم"
                txt_desc.value = ""
                txt_counter.value = "✔"
                progress_bar.value = 1
                txt_progress_text.value = "تمت بحمد الله"
                
                btn_sbh.gradient = ft.LinearGradient(colors=["#b2bec3", "#636e72"])
                btn_sbh.disabled = True
                btn_sbh.shadow.color = "#b2bec3"
            
            page.update()

        def on_click_counter(e):
            nonlocal current_count, current_index
            
            btn_sbh.scale = 0.92
            btn_sbh.update()
            time.sleep(0.08)
            btn_sbh.scale = 1.0
            btn_sbh.update()

            if current_index >= len(current_category): return

            current_count -= 1
            if current_count > 0:
                txt_counter.value = str(current_count)
                page.update()
            else:
                current_index += 1
                if current_index < len(current_category):
                    current_count = current_category[current_index]['count']
                update_view()

        def start_session(category_name):
            nonlocal current_category, current_index, current_count
            current_category = AZKAR_DATA[category_name]
            current_index = 0
            current_count = current_category[0]['count']
            
            update_view()
            
            page.clean()
            page.add(
                ft.Stack([
                    ft.Column([
                        app_bar,
                        ft.Container(height=20),
                        
                        # كارت الذكر
                        ft.Container(
                            content=ft.Column([
                                ft.Row([txt_progress_text], alignment="center"),
                                progress_bar,
                                ft.Container(height=20),
                                txt_zikr,
                                ft.Container(height=10),
                                ft.Divider(color="#f1f2f6", thickness=1),
                                txt_desc
                            ], horizontal_alignment="center"),
                            padding=25,
                            margin=20,
                            bgcolor="white",
                            border_radius=25,
                            shadow=ft.BoxShadow(blur_radius=15, color="#1A000000", offset=ft.Offset(0, 5)),
                        ),
                        
                        ft.Container(height=15),
                        btn_sbh,
                        ft.Container(height=30),
                        
                        ft.TextButton(
                            "رجوع للقائمة", 
                            icon=ft.icons.ARROW_BACK_ROUNDED, 
                            icon_color="#636e72",
                            style=ft.ButtonStyle(color="#636e72"),
                            on_click=go_home
                        )
                    ], horizontal_alignment="center")
                ])
            )

        def get_menu_card(title, sub, icon, color_start, color_end, func):
            return ft.Container(
                content=ft.Row([
                    ft.Container(
                        content=ft.Icon(icon, color="white", size=28),
                        width=55, height=55,
                        border_radius=18,
                        bgcolor=ft.colors.with_opacity(0.25, "white"),
                        alignment=ft.alignment.center
                    ),
                    ft.Container(width=15),
                    ft.Column([
                        ft.Text(title, size=18, weight="bold", color="white", font_family="Cairo"),
                        ft.Text(sub, size=12, color="#f1f2f6", font_family="CairoReg"),
                    ], spacing=3, alignment="center"),
                ], alignment="start"),
                width=330, height=95,
                padding=20,
                border_radius=22,
                gradient=ft.LinearGradient(
                    begin=ft.alignment.center_left,
                    end=ft.alignment.center_right,
                    colors=[color_start, color_end],
                ),
                shadow=ft.BoxShadow(blur_radius=10, color=color_start, offset=ft.Offset(0, 5)),
                on_click=func,
                animate_scale=ft.animation.Animation(100, ft.AnimationCurve.EASE_IN),
            )

        def go_home(e):
            page.clean()
            page.add(
                ft.Column([
                    app_bar,
                    ft.Container(height=30),
                    ft.Text("اختر الأذكار", size=20, weight="bold", color="#2d3436", font_family="Cairo"),
                    ft.Container(height=15),
                    
                    get_menu_card("أذكار الصباح", "بداية يومك بذكر الله", ft.icons.WB_SUNNY_ROUNDED, "#ff9966", "#ff5e62", lambda _: start_session("morning")),
                    ft.Container(height=15),
                    get_menu_card("أذكار المساء", "حصن المساء", ft.icons.NIGHTS_STAY_ROUNDED, "#396afc", "#2948ff", lambda _: start_session("evening")),
                    ft.Container(height=15),
                    get_menu_card("أذكار النوم", "راحة وطمأنينة", ft.icons.BED_ROUNDED, "#8e44ad", "#c0392b", lambda _: start_session("sleep")),
                    
                    ft.Container(height=40),
                    ft.Text("تطبيق ذكرني | صدقة جارية", color="#b2bec3", size=11, font_family="CairoReg")
                ], horizontal_alignment="center", scroll="hidden")
            )

        go_home(None)

    except Exception as e:
        page.add(ft.SafeArea(ft.Text(f"حدث خطأ:\n{e}", color="red", size=20)))

ft.app(target=main)
